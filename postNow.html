<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"><title>Post Now</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        :root { --bg: #fff; --text: #333; --brand: #ff4757; }
        body.dark { --bg: #1a1a1a; --text: #f0f0f0; --brand: #ff6b81; }
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: var(--bg); color: var(--text); animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 16px; box-sizing: border-box; }
        .btn { background: #28a745; color: white; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 8px; font-size: 16px; transition: 0.3s; }
    </style>
</head>
<body>
    <h1 data-zh="ğŸ’¥ ç¼–å†™åæ§½" data-en="ğŸ’¥ Post Rant">ğŸ’¥ ç¼–å†™åæ§½</h1>
    <form id="pForm">
        <input type="text" id="n" data-zh-ph="ä½ çš„å¤§å..." data-en-ph="Your Nickname..." required>
        <input type="text" id="t" data-zh-ph="èµ·ä¸ªæ ‡é¢˜..." data-en-ph="Rant Title..." required>
        <textarea id="c" rows="8" data-zh-ph="è¯·å¼€å§‹ä½ çš„è¡¨æ¼”..." data-en-ph="Start your story..." required></textarea>
        <button type="submit" class="btn" data-zh="ç«‹å³å‘å¸ƒ" data-en="Publish Now">ç«‹å³å‘å¸ƒ</button>
    </form>
    <button onclick="location.href='post.html'" style="background:none; border:none; color:#888; margin-top:20px; cursor:pointer;" data-zh="âŒ å–æ¶ˆé€€å‡º" data-en="âŒ Cancel">âŒ å–æ¶ˆé€€å‡º</button>

    <script>
        // ã€ç¬¬ä¸€æ­¥ã€‘å¿…é¡»æœ€å…ˆåˆå§‹åŒ–
        AV.init({
            appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI",
            appKey: "O9DYEDbkHLvecHlEactM8uPq", // å¡«å…¥äº†ä½ æˆªå›¾ä¸­çš„ Key
            serverURL: "https://m7kenaw2.api.lncldglobal.com"
        });

        const lang = localStorage.getItem('lang') || 'zh';
        if(localStorage.getItem('theme')==='dark') document.body.className='dark';
        
        document.querySelectorAll('[data-zh]').forEach(el => { el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en')); });
        document.querySelectorAll('[data-zh-ph]').forEach(el => { el.placeholder = (lang === 'zh' ? el.getAttribute('data-zh-ph') : el.getAttribute('data-en-ph')); });

        document.getElementById('pForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            try {
                const Post = AV.Object.extend('Post');
                const post = new Post();
                post.set('nickname', document.getElementById('n').value);
                post.set('title', document.getElementById('t').value);
                post.set('content', document.getElementById('c').value);
                post.set('likes', 0);
                
                const result = await post.save();
                let myPosts = JSON.parse(localStorage.getItem('my_authored_ids')) || [];
                myPosts.push(result.id);
                localStorage.setItem('my_authored_ids', JSON.stringify(myPosts));
                window.location.href = 'othersPost.html';
            } catch (err) {
                alert("å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–LeanCloudè®¾ç½®ï¼š" + err.message);
            }
        });
    </script>
</body>
</html>