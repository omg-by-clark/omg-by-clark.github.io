<style>
    /* ä¿®å¤æ·±è‰²æ¨¡å¼ä¸‹æŒ‰é’®çš„å¯¹æ¯”åº¦ */
    body.dark .card { border: 1px solid #444; }
    .back-link { display: block; margin: 30px 0; text-align: center; font-size: 1.1em; }
</style>

<body>
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 data-zh="ğŸ‘€ åæ§½å¹¿åœº Plaza" data-en="ğŸ‘€ Rant Plaza">ğŸ‘€ åæ§½å¹¿åœº Plaza</h1>
        <button id="hBtn" class="hot-btn" onclick="toggleHot()" data-zh="ğŸ”¥ çƒ­æœ" data-en="ğŸ”¥ Top 3">ğŸ”¥ çƒ­æœ</button>
    </div>

    <div id="list">åŠ è½½ä¸­...</div>

    <div style="border-top: 1px solid var(--brand); margin-top: 20px;">
        <a href="index.html" class="back-link" data-zh="ğŸ  è¿”å›é¦–é¡µ Back Home" data-en="ğŸ  Back Home">ğŸ  è¿”å›é¦–é¡µ Back Home</a>
    </div>

    <script>
        AV.init({ appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", appKey: "O9DYEDbkHLvecHlEact4ANKO", serverURL: "https://m7kenaw2.api.lncldglobal.com" });
        
        // 1. ç«‹å³åº”ç”¨ä¸»é¢˜å’Œè¯­è¨€
        function applySettings() {
            const isDark = localStorage.getItem('theme') === 'dark';
            document.body.className = isDark ? 'dark' : '';
            const lang = localStorage.getItem('lang') || 'zh';
            document.querySelectorAll('[data-zh]').forEach(el => {
                el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en'));
            });
        }
        applySettings();

        async function render() {
            const list = document.getElementById('list');
            const myLiked = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            const isDarkMode = document.body.classList.contains('dark');

            try {
                const query = new AV.Query('Post');
                isHot ? query.descending('likes').limit(3) : query.descending('createdAt');
                const posts = await query.find();
                
                list.innerHTML = posts.map(p => {
                    const isLiked = myLiked.includes(p.id);
                    let bStyle = "";
                    
                    if (isDarkMode) {
                        // æ·±è‰²æ¨¡å¼ï¼šç‚¹èµåå˜æµ…è‰²(#f0f0f0)ï¼Œæœªç‚¹èµä¿æŒæ·±è‰²(#333)
                        bStyle = isLiked ? "background:#f0f0f0; color:#111;" : "background:#333; color:#f0f0f0;";
                    } else {
                        // æµ…è‰²æ¨¡å¼ï¼šç‚¹èµåå˜æ·±è‰²(#333)ï¼Œæœªç‚¹èµä¿æŒæµ…è‰²(#fff)
                        bStyle = isLiked ? "background:#333; color:#fff;" : "background:#fff; color:#333;";
                    }

                    return `<div class="card">
                        <div><b>${p.get('title')}</b><br><small>ğŸ‘¤ ${p.get('nickname') || 'è·¯äºº'} | ğŸ‘ ${p.get('likes') || 0}</small></div>
                        <button onclick="toggleLike('${p.id}')" style="${bStyle} border:1px solid #ddd; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">ğŸ‘ ${p.get('likes') || 0}</button>
                    </div>`;
                }).join('');
            } catch (err) { 
                list.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
            }
        }
        // ... toggleLike å’Œ toggleHot é€»è¾‘ä¿æŒ ...
        render();
    </script>
</body>