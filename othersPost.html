<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>åæ§½å¹¿åœº Plaza</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        :root {
            --bg: #fffdf5;
            --text: #333;
            --card: #fff;
            --brand: #ff4757;
        }

        body.dark {
            --bg: #1a1a1a;
            --text: #f0f0f0;
            --card: #2d2d2d;
            --brand: #ff6b81;
        }

        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg);
            color: var(--text);
        }

        .card {
            background: var(--card);
            margin: 15px 0;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        button:active {
            transform: scale(1.1);
            transition: 0.1s;
        }

        .hot-btn {
            background: var(--brand);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 data-zh="ğŸ‘€ åæ§½å¹¿åœº" data-en="ğŸ‘€ Rant Plaza">ğŸ‘€ åæ§½å¹¿åœº</h1>
        <button id="hBtn" class="hot-btn" onclick="toggleHot()" data-zh="ğŸ”¥ çƒ­æœ" data-en="ğŸ”¥ Top 3">ğŸ”¥ çƒ­æœ</button>
    </div>
    <div id="list">Loading...</div>
    <script>
        AV.init({ appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", appKey: "O9DYEDbkHLvecHlEact4ANKO", serverURL: "https://m7kenaw2.api.lncldglobal.com" });
        const lang = localStorage.getItem('lang') || 'zh';
        let isHot = false;
        async function render() {
            const list = document.getElementById('list');
            const myLiked = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            try {
                const query = new AV.Query('Post');
                isHot ? query.descending('likes').limit(3) : query.descending('createdAt');
                const posts = await query.find();
                list.innerHTML = posts.map(p => {
                    const isLiked = myLiked.includes(p.id);
                    let bStyle = document.body.classList.contains('dark') ?
                        (isLiked ? 'background:#f0f0f0; color:#111;' : 'background:#333; color:#f0f0f0;') :
                        (isLiked ? 'background:#333; color:#fff;' : 'background:#fff; color:inherit;');
                    return `<div class="card">
                        <div><b>${p.get('title')}</b><br><small>ğŸ‘¤ ${p.get('nickname')} | ğŸ‘ ${p.get('likes') || 0}</small></div>
                        <button onclick="toggleLike('${p.id}')" style="${bStyle} border:1px solid #ddd; padding:10px 15px; border-radius:10px; font-weight:bold;">ğŸ‘ ${p.get('likes') || 0}</button>
                    </div>`;
                }).join('');
            } catch (err) {
                list.innerHTML = `<p style="color:red;">Error: ${err.message}. <br>ğŸ è‹¹æœæ‰‹æœºè¯·åœ¨ Safari è®¾ç½®ä¸­å…³é—­â€œéšè— IP åœ°å€â€ã€‚</p>`;
            }
        }
        async function toggleLike(id) {
            let likedIds = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            const idx = likedIds.indexOf(id);
            const post = AV.Object.createWithoutData('Post', id);
            idx === -1 ? (post.increment('likes', 1), likedIds.push(id)) : (post.increment('likes', -1), likedIds.splice(idx, 1));
            await post.save(); localStorage.setItem('my_liked_ids', JSON.stringify(likedIds)); render();
        }
        function toggleHot() { isHot = !isHot; render(); }
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
        render();
    </script>
</body>

</html>