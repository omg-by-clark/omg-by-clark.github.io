<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"><title>åæ§½å¹¿åœº Plaza</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        :root { --bg: #fffdf5; --text: #333; --card: #fff; --brand: #ff4757; }
        body.dark { --bg: #1a1a1a; --text: #f0f0f0; --card: #2d2d2d; --brand: #ff6b81; }
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: var(--bg); color: var(--text); transition: 0.3s; }
        .card { background: var(--card); margin: 15px 0; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        /* ç«™é•¿è¦æ±‚çš„ç‚¹å‡»æ”¾å¤§åŠ¨æ•ˆ */
        button:active { transform: scale(1.1); transition: 0.1s; }
        .hot-btn { background: linear-gradient(45deg, var(--brand), #ffa502); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 data-zh="ğŸ‘€ åæ§½å¹¿åœº" data-en="ğŸ‘€ Rant Plaza">ğŸ‘€ åæ§½å¹¿åœº</h1>
        <button id="hBtn" class="hot-btn" onclick="toggleHot()" data-zh="ğŸ”¥ çƒ­æœ" data-en="ğŸ”¥ Top 3">ğŸ”¥ çƒ­æœ</button>
    </div>
    <div id="list" style="min-height: 200px;">åŠ è½½ä¸­... / Loading...</div>
    <a href="index.html" style="color: var(--brand); text-decoration: none; font-weight: bold;" data-zh="ğŸ  è¿”å›é¦–é¡µ" data-en="ğŸ  Back Home">ğŸ  è¿”å›é¦–é¡µ</a>

    <script>
        AV.init({ appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", appKey: "O9DYEDbkHLvecHlEact4ANKO", serverURL: "https://m7kenaw2.api.lncldglobal.com" });
        const lang = localStorage.getItem('lang') || 'zh';
        if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

        document.querySelectorAll('[data-zh]').forEach(el => { el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en')); });

        let isHot = false;
        async function render() {
            const list = document.getElementById('list');
            const hBtn = document.getElementById('hBtn');
            const myLiked = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            const isDarkMode = document.body.classList.contains('dark');

            // ä¿®å¤ Top 3 æŒ‰é’®æ–‡å­—åé¦ˆ
            if(isHot) { hBtn.innerText = (lang === 'zh' ? 'â¬…ï¸ å…¨éƒ¨' : 'â¬…ï¸ All'); hBtn.style.opacity = '0.7'; }
            else { hBtn.innerText = (lang === 'zh' ? 'ğŸ”¥ çƒ­æœ' : 'ğŸ”¥ Top 3'); hBtn.style.opacity = '1'; }

            try {
                const query = new AV.Query('Post');
                isHot ? query.descending('likes').limit(3) : query.descending('createdAt');
                const posts = await query.find();
                list.innerHTML = posts.map(p => {
                    const isLiked = myLiked.includes(p.id);
                    // ç«™é•¿è¦æ±‚çš„é¢œè‰²åè½¬ï¼šæ·±è‰²æ¨¡å¼å·²èµå˜æµ…(#f0f0f0)ï¼Œæœªèµå˜æ·±(#333)
                    let bStyle = isDarkMode ? 
                        (isLiked ? 'background:#f0f0f0; color:#1a1a1a;' : 'background:#333; color:#f0f0f0;') : 
                        (isLiked ? 'background:#333; color:white;' : 'background:#fff; color:inherit;');
                    return `<div class="card">
                        <div style="flex:1">
                            <a href="content.html?id=${p.id}" style="text-decoration:none; color:inherit; font-size:1.1em;"><b>${p.get('title')}</b></a>
                            <div style="font-size:0.8em; color:#888;">ğŸ‘¤ ${p.get('nickname')} | ğŸ‘ ${p.get('likes') || 0}</div>
                        </div>
                        <button onclick="toggleLike('${p.id}')" style="${bStyle} border:1px solid #ddd; padding:10px 15px; border-radius:10px; cursor:pointer; font-weight:bold;">ğŸ‘ ${p.get('likes') || 0}</button>
                    </div>`;
                }).join('');
            } catch (err) { list.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`; }
        }
        async function toggleLike(id) {
            let likedIds = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            const idx = likedIds.indexOf(id);
            const post = AV.Object.createWithoutData('Post', id);
            idx === -1 ? (post.increment('likes', 1), likedIds.push(id)) : (post.increment('likes', -1), likedIds.splice(idx, 1));
            await post.save();
            localStorage.setItem('my_liked_ids', JSON.stringify(likedIds));
            render();
        }
        function toggleHot() { isHot = !isHot; render(); }
        render();
    </script>
</body>
</html>