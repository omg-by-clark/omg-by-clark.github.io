<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åæ§½å¹¿åœº Plaza - omg-by-Clark</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        :root { --bg: #fffdf5; --text: #333; --card: #fff; --brand: #ff4757; }
        body.dark { --bg: #1a1a1a; --text: #f0f0f0; --card: #2d2d2d; --brand: #ff6b81; }
        
        body { 
            font-family: sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
            background: var(--bg); 
            color: var(--text); 
            transition: 0.3s; 
        }

        /* å¸–å­å¡ç‰‡æ ·å¼ï¼šå¢åŠ æ‰‹å‹æŒ‡é’ˆå’Œè¿‡æ¸¡åŠ¨ç”» */
        .card { 
            background: var(--card); 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 12px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            cursor: pointer; 
            transition: transform 0.1s;
        }

        /* 1.1 å€ç‚¹å‡»ç¼©æ”¾æ•ˆæœ */
        .card:active, button:active, .back-link:active { transform: scale(1.1); }
        
        .hot-btn { background: var(--brand); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        
        /* åº•éƒ¨å¯¼èˆªé“¾æ¥ */
        .back-link { 
            display: inline-block; 
            margin-top: 30px; 
            color: var(--brand); 
            text-decoration: none; 
            font-weight: bold; 
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 data-zh="ğŸ‘€ åæ§½å¹¿åœº Plaza" data-en="ğŸ‘€ Rant Plaza">ğŸ‘€ åæ§½å¹¿åœº Plaza</h1>
        <button id="hBtn" class="hot-btn" onclick="toggleHot()" data-zh="ğŸ”¥ çƒ­æœ" data-en="ğŸ”¥ Top 3">ğŸ”¥ çƒ­æœ</button>
    </div>

    <div id="list">åŠ è½½ä¸­...</div>

    <a href="index.html" class="back-link" data-zh="ğŸ  è¿”å›é¦–é¡µ Back Home" data-en="ğŸ  Back Home">ğŸ  è¿”å›é¦–é¡µ Back Home</a>

    <script>
        // åˆå§‹åŒ– LeanCloud
        AV.init({ appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", appKey: "O9DYEDbkHLvecHlEact4ANKO", serverURL: "https://m7kenaw2.api.lncldglobal.com" });
        
        const lang = localStorage.getItem('lang') || 'zh';
        if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
        
        let isHot = false;

        async function render() {
            const list = document.getElementById('list');
            const myLiked = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            const isDarkMode = document.body.classList.contains('dark');

            try {
                const query = new AV.Query('Post');
                isHot ? query.descending('likes').limit(3) : query.descending('createdAt');
                const posts = await query.find();
                
                list.innerHTML = posts.map(p => {
                    const isLiked = myLiked.includes(p.id);
                    let bStyle = "";

                    // ä¸¥æ ¼æ‰§è¡Œæ·±è‰²æ¨¡å¼ç‚¹èµé€»è¾‘ï¼šç‚¹èµåæµ…è‰²ï¼Œæ²¡ç‚¹èµæ·±è‰²
                    if (isDarkMode) {
                        bStyle = isLiked ? 'background:#f0f0f0; color:#111;' : 'background:#333; color:#f0f0f0;';
                    } else {
                        bStyle = isLiked ? 'background:#333; color:#fff;' : 'background:#fff; color:inherit;';
                    }

                    // ğŸ”¥ æ ¸å¿ƒä¿®å¤ï¼šæ·»åŠ  onclick è·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œå¹¶ä½¿ç”¨ event.stopPropagation() é˜²æ­¢ç‚¹èµæ—¶è·³è½¬
                    return `
                    <div class="card" onclick="location.href='content.html?id=${p.id}'">
                        <div>
                            <b style="font-size:1.1em;">${p.get('title')}</b>
                            <br>
                            <small>ğŸ‘¤ ${p.get('nickname') || 'è·¯äºº'} | ğŸ‘ ${p.get('likes') || 0}</small>
                        </div>
                        <button onclick="event.stopPropagation(); toggleLike('${p.id}')" 
                                style="${bStyle} border:1px solid #ddd; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">
                            ğŸ‘ ${p.get('likes') || 0}
                        </button>
                    </div>`;
                }).join('');
            } catch (err) { 
                list.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
            }
        }

        async function toggleLike(id) {
            let likedIds = JSON.parse(localStorage.getItem('my_liked_ids')) || [];
            const idx = likedIds.indexOf(id);
            const post = AV.Object.createWithoutData('Post', id);
            idx === -1 ? (post.increment('likes', 1), likedIds.push(id)) : (post.increment('likes', -1), likedIds.splice(idx, 1));
            await post.save(); 
            localStorage.setItem('my_liked_ids', JSON.stringify(likedIds)); 
            render();
        }

        function toggleHot() { isHot = !isHot; render(); }

        // æ‰§è¡Œç¿»è¯‘é€»è¾‘
        document.querySelectorAll('[data-zh]').forEach(el => {
            el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en'));
        });

        render();
    </script>
</body>
</html>