<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Admin Control - åæ§½ç«™åå°</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: #fff; max-width: 800px; margin: 0 auto; padding: 20px; }
        .post-card { background: #1e1e1e; border: 1px solid #333; padding: 15px; margin-bottom: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; gap: 10px; }
        button { border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-cmt { background: #28a745; color: white; } /* ç®¡ç†è¯„è®º-ç»¿è‰² */
        .btn-zero { background: #ffa502; color: white; } /* èµæ•°æ¸…é›¶-æ©™è‰² */
        .btn-del { background: #ff4757; color: white; } /* åˆ é™¤å¸–å­-çº¢è‰² */
        button:hover { opacity: 0.8; transform: scale(1.05); }
    </style>
</head>
<body>
    <h2 style="color: #ff4757;">ğŸ‘‘ å…¨ç«™åå°ç®¡ç†ä¸­å¿ƒ</h2>
    <div id="admin-list">æ•°æ®è¯»å–ä¸­...</div>
    <br><a href="index.html" style="color:#888; text-decoration: none;">ğŸ  è¿”å›é¦–é¡µ</a>

    <script>
        // 1. åˆå§‹åŒ–ç”µæº
        AV.init({
            appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI",
            appKey: "O9DYEDbkHLvecHlEact4ANKO",
            serverURL: "https://m7kenaw2.api.lncldglobal.com"
        });

        // 2. æ¸²æŸ“åˆ—è¡¨
        async function draw() {
            try {
                const query = new AV.Query('Post');
                query.descending('createdAt');
                const posts = await query.find();
                
                document.getElementById('admin-list').innerHTML = posts.map(p => `
                    <div class="post-card">
                        <div>
                            <b style="font-size:1.1em;">${p.get('title')}</b><br>
                            <small style="color:#aaa;">ä½œè€…: ${p.get('nickname')} | èµ: ${p.get('likes') || 0}</small>
                        </div>
                        <div class="btn-group">
                            <button class="btn-cmt" onclick="location.href='content.html?id=${p.id}'">ç®¡ç†è¯„è®º</button>
                            <button class="btn-zero" onclick="resetLikes('${p.id}')">èµæ•°æ¸…é›¶</button>
                            <button class="btn-del" onclick="realDelete('${p.id}')">åˆ é™¤å¸–å­</button>
                        </div>
                    </div>`).join('') || "ç›®å‰æ•°æ®åº“é‡Œç©ºç©ºå¦‚ä¹Ÿ";
            } catch (err) {
                document.getElementById('admin-list').innerHTML = `<p style="color:red;">åŠ è½½å¤±è´¥ï¼š${err.message}</p>`;
            }
        }

        // 3. èµæ•°å¼ºåˆ¶æ¸…é›¶é€»è¾‘
        async function resetLikes(id) {
            if(confirm('ç«™é•¿ï¼Œç¡®å®šè¦æŠŠè¿™æ¡åæ§½çš„èµæ•°å½»åº•æ¸…é›¶å—ï¼Ÿ')) {
                const post = AV.Object.createWithoutData('Post', id);
                post.set('likes', 0);
                await post.save();
                draw(); // åˆ·æ–°ç•Œé¢
            }
        }

        // 4. å½»åº•åˆ é™¤å¸–å­é€»è¾‘
        async function realDelete(id) {
            if(confirm('ã€è­¦å‘Šã€‘ä½œä¸ºç«™é•¿ï¼Œä½ ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™æ¡å…¨ç½‘å¯è§çš„å¸–å­å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                const post = AV.Object.createWithoutData('Post', id);
                await post.destroy();
                draw(); // åˆ·æ–°ç•Œé¢
            }
        }

        draw();
    </script>
</body>
</html>