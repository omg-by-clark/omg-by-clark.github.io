<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° Admin Dashboard - omg-by-Clark</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        /* ä¿æŒæ·±è‰²ç®¡ç†é£æ ¼ */
        body { background: #121212; color: #fff; font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .post-card { background: #1e1e1e; padding: 15px; margin-bottom: 10px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        
        /* 1.1å€æœå†»ç¼©æ”¾ç‰¹æ•ˆ */
        button:active, .back-link:active { transform: scale(1.1); transition: 0.1s; }
        
        .btn-del { background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .back-link { color: #888; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 20px; }
    </style>
</head>
<body>
    <script>
        // æƒé™æ ¡éªŒé€»è¾‘
        if (localStorage.getItem('isAdmin') !== 'true' && window.name !== 'isAdmin_true') {
            window.location.href = 'index.html';
        }
    </script>

    <h2 data-zh="ğŸ‘‘ ç®¡ç†å‘˜åå°" data-en="ğŸ‘‘ Admin Dashboard">ğŸ‘‘ ç®¡ç†å‘˜åå°</h2>
    
    <div id="admin-list" data-zh="åŠ è½½ä¸­..." data-en="Loading...">åŠ è½½ä¸­...</div>
    
    <br>
    <a href="index.html" class="back-link" data-zh="ğŸ  è¿”å›é¦–é¡µ" data-en="ğŸ  Back Home">ğŸ  è¿”å›é¦–é¡µ</a>

    <script>
        const lang = localStorage.getItem('lang') || 'zh';
        
        // åˆå§‹åŒ– LeanCloud
        AV.init({ 
            appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", 
            appKey: "O9DYEDbkHLvecHlEact4ANKO", 
            serverURL: "https://m7kenaw2.api.lncldglobal.com" 
        });

        // ç»Ÿä¸€åº”ç”¨è¯­è¨€ç¿»è¯‘
        function applyLang() {
            document.querySelectorAll('[data-zh]').forEach(el => {
                el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en'));
            });
        }

        async function draw() {
            const listEl = document.getElementById('admin-list');
            try {
                const query = new AV.Query('Post').descending('createdAt');
                const posts = await query.find();
                
                if (posts.length === 0) {
                    listEl.innerHTML = `<p style="color:#888">${lang === 'zh' ? 'æš‚æ— å¸–å­' : 'No posts found'}</p>`;
                    return;
                }

                listEl.innerHTML = posts.map(p => `
                    <div class="post-card">
                        <div>
                            <b>${p.get('title')}</b>
                            <br>
                            <small>${lang === 'zh' ? 'ä½œè€…' : 'By'}: ${p.get('nickname')} | ğŸ‘ ${p.get('likes') || 0}</small>
                        </div>
                        <button class="btn-del" onclick="del('${p.id}')">
                            ${lang === 'zh' ? 'åˆ é™¤' : 'Delete'}
                        </button>
                    </div>`).join('');
            } catch (err) { 
                listEl.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`; 
            }
        }

        // åˆ é™¤é€»è¾‘ä¸ä¸­æ–‡ç¡®è®¤å¼¹çª—
        async function del(id) { 
            const msg = lang === 'zh' ? 'ç¡®å®šè¦åˆ é™¤æ­¤è´´å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼' : 'Are you sure? This cannot be undone!';
            if(confirm(msg)) { 
                await AV.Object.createWithoutData('Post', id).destroy(); 
                draw(); 
            } 
        }

        // å¯åŠ¨é¡µé¢
        applyLang();
        draw();
    </script>
</body>
</html>