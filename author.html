<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Admin Control</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: #121212;
            color: #fff;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .post-card {
            background: #1e1e1e;
            border: 1px solid #333;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
        }

        .btn-del {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h2>ğŸ‘‘ å…¨ç«™åå°ç®¡ç†</h2>
    <div id="admin-list">åŠ è½½ä¸­...</div>
    <br><a href="index.html" style="color:#888;">è¿”å›é¦–é¡µ</a>

    <script>
        AV.init({
            appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI",
            appKey: "O9DYEDbkHLvecHlEact4ANKO",
            serverURL: "https://m7kenaw2.api.lncldglobal.com"
        });

        async function draw() {
            const query = new AV.Query('Post');
            query.descending('createdAt');
            const posts = await query.find();
            document.getElementById('admin-list').innerHTML = posts.map(p => `
            <div class="post-card">
                <div>
                    <b>${p.get('title')}</b><br>
                    <small>ä½œè€…: ${p.get('nickname')} | èµ: ${p.get('likes') || 0}</small>
                </div>
                <div>
                    <button onclick="location.href='content.html?id=${p.id}'" style="background:#28a745; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer;">ç®¡è¯„è®º</button>
                    <button onclick="resetLikes('${p.id}')" style="background:#ffa502; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer;">èµæ¸…é›¶</button>
                    <button onclick="realDelete('${p.id}')" style="background:#ff4757; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer;">åˆ å¸–</button>
                </div>
            </div>`).join('');
        }

        // ğŸ”¥ èµæ•°å¼ºåˆ¶æ¸…é›¶åŠŸèƒ½
        async function resetLikes(postId) {
            if (confirm('ç¡®å®šè¦æŠŠè¿™æ¡åæ§½çš„èƒ½é‡ï¼ˆèµæ•°ï¼‰æ¸…ç©ºå—ï¼Ÿ')) {
                const post = AV.Object.createWithoutData('Post', postId);
                post.set('likes', 0);
                await post.save();
                draw();
            }
        }

        async function realDelete(postId) {
            if (confirm('ç¡®å®šæ°¸ä¹…åˆ é™¤è¿™æ¡å¸–å­å—ï¼Ÿ')) {
                await AV.Object.createWithoutData('Post', postId).destroy();
                draw();
            }
        }
        draw();
    </script>
</body>

</html>