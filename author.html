<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"><title>Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: #fff; max-width: 800px; margin: 0 auto; padding: 20px; }
        .post-card { background: #1e1e1e; border: 1px solid #333; padding: 20px; margin-bottom: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; gap: 10px; }
        button { border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        button:active { transform: scale(1.1); }
        .btn-cmt { background: #28a745; color: white; }
        .btn-zero { background: #ffa502; color: white; }
        .btn-del { background: #ff4757; color: white; }
    </style>
</head>
<body>
    <h2 data-zh="ğŸ‘‘ å…¨ç«™åå°ç®¡ç†ä¸­å¿ƒ" data-en="ğŸ‘‘ Admin Dashboard">ğŸ‘‘ å…¨ç«™åå°ç®¡ç†ä¸­å¿ƒ</h2>
    <div id="admin-list">Loading...</div>
    <br><a href="index.html" style="color:#888; text-decoration: none;">ğŸ  è¿”å›é¦–é¡µ</a>

    <script>
        AV.init({ appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", appKey: "O9DYEDbkHLvecHlEact4ANKO", serverURL: "https://m7kenaw2.api.lncldglobal.com" });
        const lang = localStorage.getItem('lang') || 'zh';

        document.querySelectorAll('[data-zh]').forEach(el => { el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en')); });

        async function draw() {
            try {
                const query = new AV.Query('Post');
                query.descending('createdAt');
                const posts = await query.find();
                document.getElementById('admin-list').innerHTML = posts.map(p => `
                    <div class="post-card">
                        <div><b>${p.get('title')}</b><br><small>Author: ${p.get('nickname')} | Likes: ${p.get('likes') || 0}</small></div>
                        <div class="btn-group">
                            <button class="btn-cmt" onclick="location.href='content.html?id=${p.id}'">${lang==='zh'?'ç®¡ç†è¯„è®º':'Manage Comments'}</button>
                            <button class="btn-zero" onclick="resetLikes('${p.id}')">${lang==='zh'?'èµæ•°æ¸…é›¶':'Reset Likes'}</button>
                            <button class="btn-del" onclick="realDelete('${p.id}')">${lang==='zh'?'åˆ é™¤å¸–å­':'Delete Post'}</button>
                        </div>
                    </div>`).join('');
            } catch (err) { console.error(err); }
        }
        async function resetLikes(id) { if(confirm('èµæ•°æ¸…é›¶ï¼Ÿ')) { const post = AV.Object.createWithoutData('Post', id); post.set('likes', 0); await post.save(); draw(); } }
        async function realDelete(id) { if(confirm('åˆ é™¤å¸–å­ï¼Ÿ')) { await AV.Object.createWithoutData('Post', id).destroy(); draw(); } }
        draw();
    </script>
</body>
</html>