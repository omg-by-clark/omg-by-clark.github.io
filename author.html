<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° Admin Dashboard - omg-by-Clark</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        /* ä¿æŒæ·±è‰²ç®¡ç†é£æ ¼ */
        body { background: #121212; color: #fff; font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        
        .post-card { 
            background: #1e1e1e; 
            padding: 20px; 
            margin-bottom: 15px; 
            border-radius: 12px; 
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .post-info { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        
        /* æŒ‰é’®é€šç”¨æ ·å¼ä¸ 1.1å€ç¼©æ”¾ */
        button { border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.1s; }
        button:active { transform: scale(1.1); }

        /* ä½ è¦æ±‚çš„ç‰¹å®šé¢œè‰² */
        .btn-del { background: #ff4757; color: white; } /* åˆ é™¤ï¼šçº¢è‰² */
        .btn-reset { background: #f1c40f; color: #333; } /* ç‚¹èµæ¸…é›¶ï¼šé»„è‰²åº• */
        .btn-cmt { background: #2ecc71; color: white; } /* è¯„è®ºç®¡ç†ï¼šç»¿è‰²åº• */
        
        .back-link { color: #888; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 20px; }
    </style>
</head>
<body>
    <script>
        // æƒé™åŒé‡æ ¡éªŒ
        if (localStorage.getItem('isAdmin') !== 'true' && window.name !== 'isAdmin_true') {
            window.location.href = 'index.html';
        }
    </script>

    <h2 data-zh="ğŸ‘‘ ç®¡ç†å‘˜åå°" data-en="ğŸ‘‘ Admin Dashboard">ğŸ‘‘ ç®¡ç†å‘˜åå°</h2>
    
    <div id="admin-list" data-zh="åŠ è½½ä¸­..." data-en="Loading...">åŠ è½½ä¸­...</div>
    
    <br>
    <a href="index.html" class="back-link" data-zh="ğŸ  è¿”å›é¦–é¡µ" data-en="ğŸ  Back Home">ğŸ  è¿”å›é¦–é¡µ</a>

    <script>
        const lang = localStorage.getItem('lang') || 'zh';
        
        // åˆå§‹åŒ– LeanCloud
        AV.init({ 
            appId: "M7KeNAw2myFEaXvSEJPbtPpA-MdYXbMMI", 
            appKey: "O9DYEDbkHLvecHlEact4ANKO", 
            serverURL: "https://m7kenaw2.api.lncldglobal.com" 
        });

        function applyLang() {
            document.querySelectorAll('[data-zh]').forEach(el => {
                el.innerText = (lang === 'zh' ? el.getAttribute('data-zh') : el.getAttribute('data-en'));
            });
        }

        async function draw() {
            const listEl = document.getElementById('admin-list');
            try {
                const query = new AV.Query('Post').descending('createdAt');
                const posts = await query.find();
                
                if (posts.length === 0) {
                    listEl.innerHTML = `<p style="color:#888">${lang === 'zh' ? 'æš‚æ— å¸–å­' : 'No posts'}</p>`;
                    return;
                }

                listEl.innerHTML = posts.map(p => `
                    <div class="post-card">
                        <div class="post-info">
                            <div>
                                <b style="font-size:1.2em;">${p.get('title')}</b>
                                <br>
                                <small style="color:#888;">${lang === 'zh' ? 'ä½œè€…' : 'By'}: ${p.get('nickname')} | ğŸ‘ ${p.get('likes') || 0}</small>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn-cmt" onclick="location.href='content.html?id=${p.id}'">
                                ${lang === 'zh' ? 'ğŸ›¡ï¸ è¯„è®ºç®¡ç†' : 'ğŸ›¡ï¸ Comments'}
                            </button>
                            
                            <button class="btn-reset" onclick="resetLikes('${p.id}')">
                                ${lang === 'zh' ? 'â™»ï¸ ç‚¹èµæ¸…é›¶' : 'â™»ï¸ Reset Likes'}
                            </button>
                            
                            <button class="btn-del" onclick="del('${p.id}')">
                                ${lang === 'zh' ? 'ğŸ—‘ï¸ åˆ é™¤å¸–å­' : 'ğŸ—‘ï¸ Delete'}
                            </button>
                        </div>
                    </div>`).join('');
            } catch (err) { 
                listEl.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`; 
            }
        }

        // åŠŸèƒ½ï¼šç‚¹èµæ¸…é›¶
        async function resetLikes(id) {
            const msg = lang === 'zh' ? 'ç¡®å®šè¦æ¸…é›¶ç‚¹èµæ•°å—ï¼Ÿ' : 'Reset likes to 0?';
            if(confirm(msg)) {
                const post = AV.Object.createWithoutData('Post', id);
                post.set('likes', 0);
                await post.save();
                draw();
            }
        }

        // åŠŸèƒ½ï¼šåˆ é™¤å¸–å­
        async function del(id) { 
            const msg = lang === 'zh' ? 'ç¡®å®šè¦åˆ é™¤æ­¤è´´å—ï¼Ÿ' : 'Delete this post?';
            if(confirm(msg)) { 
                await AV.Object.createWithoutData('Post', id).destroy(); 
                draw(); 
            } 
        }

        applyLang();
        draw();
    </script>
</body>
</html>